(()=>{const e=(e,t,i)=>(...a)=>{try{e(...a)}catch(n){null==t||t(i||"Error in handler",n)}},t=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,i=e=>t.test(e),a=e=>i(e)?r(e):e,n=e=>i(e)?e:s(e),s=e=>btoa(unescape(encodeURIComponent(e))),r=e=>decodeURIComponent(escape(atob(e))),o=e=>e?e.split("&c=${AAX_PAYLOAD}").join(""):e;var l=function(e,t){console.error(e,JSON.stringify(t)),c("ERROR",e,m(e,t))},d=function(e,t){console.error(e,JSON.stringify(t)),c("FATAL",e,m(e,t))},c=function(e,t,i){var a;null===(a=window.ueLogError)||void 0===a||a.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},m=function(e,t){return t instanceof Error?t:t?new Error(t):new Error(e)};class h{constructor(e={},t={},i={}){this.adMap=e,this.ADS_HANDLERS=t,this.viewableLatencyTrackers=i}}class p{constructor(e){this.adMap=e,this.sendMessageToAd=(e,t,i)=>{const a={command:t,data:i};this.adMap[e].messagePort.postMessage(a)},this.sendCustomMessageToAd=(e,t,i)=>{const a={key:t,data:i};this.sendMessageToAd(e,"customMessage",a)}}}class u{constructor(e){this.supportedCommands=e,this.receiveMessage=async({data:{command:e,adDetails:t,payload:i}})=>{try{const a=this.supportedCommands[e];a&&await a(t,i)}catch(a){const e="Problem with message: "+JSON.stringify(i);l(e,a)}}}}const w=e=>e+"_Feedback";class v{async addSponsoredLabelWithFeedbackLink(e,t){e.appendChildTo(this.parentHtmlId,this);const i=await t.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(null==i?void 0:i.isOk()))throw new Error(`Result from the feedback service was not ok ${this.urlPathAndParameter}`);e.updateElement(this.getHtmlId(),i),this.modifyInlineStyle()}getHtmlId(){return w(this.parentHtmlId)}isHidden(){return this.hidden}exists(e){return e.exists(this.getHtmlId())}getFeedbackSpanElement(){return document.querySelector(`#${this.getHtmlId()} span`)}modifyInlineStyle(){const e=this.getFeedbackSpanElement();if(e){const t=e.style.getPropertyValue("font");"important"===e.style.getPropertyPriority("font")&&(e.style.removeProperty("font"),e.style.setProperty("font",t))}}constructor(e,t,i,a,n,s,r){this.parentHtmlId=e,this.feedbackStyle=t,this.labelText=i,this.labelStyle=a,this.position=n,this.urlPathAndParameter=s,this.hidden=r}}class g{open(e){e.clickChildLink(this)}getHtmlId(){return w(this.parentHtmlId)}constructor(e){this.parentHtmlId=e}}class f{async createSponsoredLabelWithFeedbackLink(e,t){if(!e.exists(this.feedbackHtmlPort)){t.request();try{await e.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),t.success(),e.isHidden()||t.labelRenderedHost()}catch(i){throw t.error(),i}}}openModal(e){e.open(this.feedbackHtmlPort)}labelRendered(e){e.labelRenderedCreative()}logTransparencyInfoMissing(e){e.transparencyInfoMissing()}constructor(e,t){this.feedbackHtmlPort=e,this.feedbackApiPort=t}}var y=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,b=new Map,x=function(){if(!b.has(window.location.href)){var e=y.exec(window.location.href),t=e&&e[3]?e[3]:null;b.set(window.location.href,t)}return b.get(window.location.href)},I=function(e){var t=x();if(!e||!t)return null;var i=e.split(":");return i.splice(i.length-1,0,t),i.join(":")},S=function(e){var t=x();return t?"".concat(e,":").concat(t):null},T=function(e){return e.replace(/_/g,":")},k=function(e,t,i){var a,n,s,r,o,l;if(void 0===i&&(i=1),!M())return window.safeframe=null!==(a=window.safeframe)&&void 0!==a?a:{},window.safeframe.csmCache=null!==(n=window.safeframe.csmCache)&&void 0!==n?n:{},window.safeframe.csmCache.incrementCsmPlacementCounter=null!==(s=window.safeframe.csmCache.incrementCsmPlacementCounter)&&void 0!==s?s:[],void window.safeframe.csmCache.incrementCsmPlacementCounter.push({metric:e,placement:t,count:i});null===(l=null===(o=null===(r=window.safeframe)||void 0===r?void 0:r.csmCache)||void 0===o?void 0:o.incrementCsmPlacementCounter)||void 0===l||l.forEach((function(e){return k(e.metric,e.placement,e.count)}));var d=function(e,t,i){t&&A("".concat(N(e),":").concat(t),i)};d(e,t.id,i),d(e,S(t.id),i),d(e,T(t.name),i),d(e,I(T(t.name)),i)},E=function(e,t){var i,a,n,s,r,o;if(void 0===t&&(t=1),!M())return window.safeframe=null!==(i=window.safeframe)&&void 0!==i?i:{},window.safeframe.csmCache=null!==(a=window.safeframe.csmCache)&&void 0!==a?a:{},window.safeframe.csmCache.incrementCsmCounter=null!==(n=window.safeframe.csmCache.incrementCsmCounter)&&void 0!==n?n:[],void window.safeframe.csmCache.incrementCsmCounter.push({metric:e,count:t});null===(o=null===(r=null===(s=window.safeframe)||void 0===s?void 0:s.csmCache)||void 0===r?void 0:r.incrementCsmCounter)||void 0===o||o.forEach((function(e){return E(e.metric,e.count)})),A(N(e),t)},M=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.count)},A=function(e,t){var i;return null===(i=null===window||void 0===window?void 0:window.ue)||void 0===i?void 0:i.count(e,t)},C="adplacements",N=function(e){return e.startsWith(C)?e:"".concat(C,":").concat(e)},F=function(e){if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(t){l("Error with 'setEntity' CSA",t)}},L=function(e,t,i){if(void 0===i&&(i=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:i},{ent:"all"})}catch(a){l("Error with 'logCsaEvent' CSA",a)}},D=function(e,t){if(void 0===t&&(t=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e,metricValue:t},{ent:"all"})}catch(i){l("Error with 'incrementCounter' CSA",i)}};const _=e=>new j(e),z="adfeedback_request",O="adfeedback_success",B="adfeedback_error",R="adfeedback_sponsoredlabelrendered_creative",H="adfeedback_sponsoredlabelrendered_host",U="adfeedback:request",$="adfeedback:success",W="adfeedback:error",V="adfeedback:sponsoredlabelrendered:creative",q="adfeedback:sponsoredlabelrendered:host",J="adfeedback:sponsoredlabelrendered",X="adfeedback:transparencyinfo:missing";class j{request(){k(U,this.placement),E(U),L(z,this.placement)}success(){k($,this.placement),E($),L(O,this.placement)}error(){k(W,this.placement),L(B,this.placement)}labelRenderedCreative(){k(V,this.placement),E(J),L(R,this.placement)}labelRenderedHost(){k(q,this.placement),E(J),L(H,this.placement)}transparencyInfoMissing(){k(X,this.placement),E(X)}constructor(e){this.placement=e}}class Y{isOk(){return"ok"===this.status}constructor(e,t,i){this.status=e,this.html=t,this.script=i}}class K{async getSponsoredLabelAndFeedbackLink(e){const t=await window.fetch(this.windowRepo.origin()+e);if(t.ok){const e=await t.json();return new Y(e.status,e.html,e.script)}throw Error("Could not fetch the feedback html/link/script/label")}constructor(e){this.windowRepo=e}}class G{appendChildTo(e,t){var i,a;function n(e,t){const i=document.createElement("div");return i.setAttribute("id",t.getHtmlId()),i.classList.add("ape-feedback"),i.style.position="relative",i.style.height="20px",i.style.textAlign=i.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",i.style.padding="0",i.style.marginTop="2px",i.style.display=t.feedbackStyle.display,e.endsWith("_wrapper")&&(!e.includes("-ilm")&&(i.style.maxWidth="min(100vh, 100vw)"),i.style.marginLeft="auto",i.style.marginRight="auto",i.style.padding="0 5px"),i.append(function(e){const t=document.createElement("div");return t.innerHTML=e.labelText,Z(t,e.labelStyle),t}(t)),i}1===t.position?null===(i=document.getElementById(e))||void 0===i||i.prepend(n(e,t)):0===t.position&&(null===(a=document.getElementById(e))||void 0===a||a.append(n(e,t)))}updateElement(e,t){const i=document.getElementById(e);if(i){i.innerHTML=t.html,Q(i,t);for(const e of i.children)"DIV"===e.tagName?e.removeAttribute("style"):"A"===e.tagName&&(e.style.removeProperty("position"),e.style.removeProperty("top"),e.style.removeProperty("right"),e.style.removeProperty("display"))}}clickChildLink(e){const t=document.getElementById(e.getHtmlId());for(const a of(null==t?void 0:t.children)||[])if("A"===(i=a).tagName||"DIV"===i.tagName)return void a.click();var i}exists(e){return!!document.getElementById(e)}}const Z=(e,t)=>{for(const i in t)e.style.setProperty(i,t[i])},Q=(e,t)=>{ee(e).innerHTML=t.script},ee=e=>{const t=document.createElement("script");return e.prepend(t),t},te={code:"BE",hostname:"www.amazon.com.be",name:"Belgium"},ie={code:"FR",hostname:"www.amazon.fr",name:"France"},ae={code:"DE",hostname:"www.amazon.de",name:"Germany"},ne={code:"IT",hostname:"www.amazon.it",name:"Italy"},se={code:"NL",hostname:"www.amazon.nl",name:"Netherlands"},re={code:"PL",hostname:"www.amazon.pl",name:"Poland"},oe={code:"ES",hostname:"www.amazon.es",name:"Spain"},le={code:"SE",hostname:"www.amazon.se",name:"Sweden"},de=e=>location.hostname===e.hostname,ce=e=>!(de(te)||de(ie)||de(ae)||de(ne)||de(se)||de(re)||de(oe)||de(le))||me(e),me=e=>{var t,i,a,n,s,r;const o=[];pe(null==e||null===(a=e.url)||void 0===a||null===(i=a.parameters)||void 0===i||null===(t=i.adPlacementMetaData)||void 0===t?void 0:t.slotName)&&o.push("DSA Error: slotName missing");const d=null==e||null===(r=e.url)||void 0===r||null===(s=r.parameters)||void 0===s||null===(n=s.adCreativeMetaData)||void 0===n?void 0:n.adCreativeDetails;(!d||d.length<=0)&&o.push("DSA Error: transparency info missing"),null==d||d.every((e=>he(e,o)));for(const c of o)l(c);return o.length<=0},he=(e,t)=>{var i,a,n,s,r;e.version||t.push("DSA Error: version missing"),pe(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),void 0!==(null===(i=e.selectionSignals)||void 0===i?void 0:i.context)&&null!==(null===(a=e.selectionSignals)||void 0===a?void 0:a.context)||t.push("DSA Error: selectionSignals.context missing"),void 0!==(null===(n=e.selectionSignals)||void 0===n?void 0:n.location)&&null!==(null===(s=e.selectionSignals)||void 0===s?void 0:s.location)||t.push("DSA Error: selectionSignals.location missing"),pe(null===(r=e.selectionSignals)||void 0===r?void 0:r.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},pe=e=>!(null==e?void 0:e.trim());class ue{constructor(e,t){this.weblabsWindow=e,this.prefix=t,this.isT1=()=>"t1"===this.weblabTreatment(),this.isT2=()=>"t2"===this.weblabTreatment(),this.isT3=()=>"t3"===this.weblabTreatment(),this.isT4=()=>"t4"===this.weblabTreatment(),this.isT5=()=>"t5"===this.weblabTreatment(),this.weblabTreatment=()=>{var e,t,i;return null===(i=this.weblabsWindow)||void 0===i||null===(t=i.renderingWeblabs)||void 0===t||null===(e=t[this.prefix])||void 0===e?void 0:e.toLowerCase()}}}const we=()=>new ue(window,"ADPT_SF_FOCUS_DETECTION_1175381"),ve=()=>new ue(window,"APM_STORES_JPS_JRS_SAFEFRAME_A11Y_PLACEMENT_SCALING_1218301"),ge=()=>new ue(window,"APM_STORES_JPS_JRS_SAFEFRAME_UX_ELEMENT_OBSTRUCTION_DETECTION_1220127"),fe=()=>new ue(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_OBSTRUCTIONS_1226495"),ye=()=>new ue(window,"APM_STORES_JPS_JRS_SAFEFRAME_SERVER_SIDE_CREATIVE_SIZING_1230792"),be=()=>new xe(new f(new G,new K({origin:()=>window.location.origin})));class xe{async addSponsoredLabel({parentHtmlId:e,placement:t,feedback:i}){return!!new ue(window,"ADPT_SF_SERVER_SIDE_SPONSORED_LABEL_998980").isT1()||(ce(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(Ie(e,i),_(t)),!0):(this.feedbackService.logTransparencyInfoMissing(_(t)),l("Transparency Information missing"),!1))}openModal(e){this.feedbackService.openModal(new g(e))}labelRendered({placement:e}){this.feedbackService.labelRendered(_(e))}constructor(e){this.feedbackService=e}}const Ie=(e,t)=>{const i=JSON.parse(JSON.stringify(t.url.parameters));return i.adPlacementMetaData.pageUrl=n(i.adPlacementMetaData.pageUrl),new v(e,t.style,t.label.text,t.label.style,"TOP"===t.position?1:0,"/af/feedback-link?pl="+encodeURIComponent(JSON.stringify(i)),t.hidden)},Pe=e=>{be().labelRendered({placement:{id:e.placementId,name:e.placementName}})},Se=e=>{be().openModal(e.adPlacementMetaData.adElementId)},Te=async e=>{if(!(await be().addSponsoredLabel(ke(e))))throw new Error("Failed to create sponsored label and feedback link")},ke=e=>{const t=e.adPlacementMetaData,i=e.adFeedbackInfo;var s;return{parentHtmlId:null!==(s=e.adUnitWrapperId)&&void 0!==s?s:e.adUnitPlacementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:"BOTTOM",hidden:!i.boolFeedback,style:e.feedbackDivStyle,url:{parameters:{adPlacementMetaData:{adElementId:t.adElementId,pageType:t.pageType,pageUrl:n(t.pageUrl),slotName:t.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:a(i.sponsoredText),style:e.advertisementStyle}}}},Ee={DESKTOP:{em:16,rem:16},MSHOP:{em:16,rem:10},MWEB:{em:16,rem:10}},Me=e=>!e||Ae(e)||Ce(e)?e:e+"px",Ae=e=>(null==e?void 0:e.length)>1&&"%"===e.charAt(e.length-1),Ce=e=>e.length>2&&"px"===e.substring(e.length-2),Ne=e=>Ae(e)?e:`${parseInt(e)}px`,Fe=(e,t="MWEB")=>{if(Ae(e))return e;const i=parseFloat(e),a=Le()?"em":"rem",n=Ee[t][a];return i&&n?`${i/n}${a}`:"inherit"},Le=(()=>{let e;const t=()=>(void 0===e&&(e=/iPad|iPhone|iPod/.test(navigator.userAgent)),e);return t.clear=()=>{e=void 0},t})(),De=(e,t)=>{const i=new Set(["bf4ab3db-618a-4853-ae89-3ad3bd17df16","dd4c5e61-fe9a-4d91-9deb-25fa60557719","da326e4a-90bd-4da3-a526-53301eb2c6a0","ca609359-3cb9-4984-8830-231c22e978d3","15554fd8-4c3e-45c6-ae61-84c65966f5d1","1396c5b8-45a1-4618-9a09-0b84209807f9","d9fb239d-fcde-414f-98a8-409c81052388","b60ea84b-3e24-44dc-9fdb-35bb2fb1fe5c","75b4c7aa-4c22-49d3-8371-15ca116eaf1f","ef368293-2611-4cef-8050-4fcd9b97f12e","db5cbac6-5194-4b52-9929-9ec0bbfed990","6479c6f3-a9c2-4d7c-9d1a-45008113fe0c"]);new ue(window,"A2I_HOMEPAGE_CARD_THEMING_360311").isT1()&&i.has(e)&&(t&&(t.style.background="#FAE859"),t&&(t.style.margin="0px"))},_e="nav-ewc-persistent-hover",ze=()=>null!==document.querySelector(`.${_e}`),Oe=e=>"attributes"===e.type&&"class"===e.attributeName&&e.target.classList.contains(_e),Be=e=>{if(ze())return void Re(e);new MutationObserver(((t,i)=>{if(t.some(Oe))try{Re(e),i.disconnect()}catch(a){l("Failed to resize ILM for EWC.",a)}})).observe(window.document.documentElement,{attributes:!0,attributeFilter:["class"]})},Re=e=>{const t=document.querySelector("div#nav-flyout-ewc");if(null===e||null===t)return void l(`could not find placementDiv (value was: ${e}) or ewc (value was: ${t})`);const i=t.offsetWidth;He(e,i)},He=(e,t)=>{var i,a;const n=document.createElement("style");n.innerHTML=`@media screen and (min-width: 1500px) { div[id$=${e.id}] {\n        width: calc(100vw - ${t+5}px) !important;\n        margin-left: calc(-50vw + 50% + ${t/2}px) !important;\n        margin-right: calc(-50vw + 50% + ${t/2}px) !important;\n    `,null===(a=document)||void 0===a||null===(i=a.body)||void 0===i||i.appendChild(n)},Ue=["alm-morrisons-storefront-desktop-ad-1","alm-morrisons-storefront-desktop-ad-2","alm-monoprix-storefront-desktop-ad-1","alm-monoprix-storefront-desktop-ad-2","alm-dia-storefront-desktop-ad-1","alm-dia-storefront-desktop-ad-2","alm-storefront-desktop-ad-1","alm-storefront-desktop-ad-2","alm-wfm-storefront-desktop-ad-1","alm-wfm-storefront-desktop-ad-2"],$e=["desktop-detail-ilm","vindp-desktop-atf-ilm","fresh-desktop-detail-ilm","wfm-desktop-detail-ilm","alm-weis-desktop-detail-ilm","alm-save-desktop-detail-ilm","alm-lucky-desktop-detail-ilm","alm-bristol-desktop-detail-ilm","alm-rite-desktop-detail-ilm","alm-bartell-desktop-detail-ilm","alm-cardenas-desktop-detail-ilm","alm-petfoodexpress-desktop-detail-ilm","alm-allthebestpetcare-desktop-detail-ilm"],We=["mobile-detail-ilm","mobile-app-detail-ilm","fresh-mobile-detail-ilm","fresh-mobile-detail-ilm-v1","wfm-mobile-detail-ilm-v1"],Ve=["asr-indie-manga-banner","asr-indie-fliptoon-banner","asr-managed-fliptoon-banner","fresh-ad-left","fresh-ad-left-2","alm-wfm-fresh-ad-left","wfm-ad-left-2","alm-monoprix-fresh-ad-left","alm-monoprix-ad-left-2","alm-morrisons-fresh-ad-left","alm-morrisons-ad-left-2","alm-dia-fresh-ad-left","alm-dia-ad-left-2","alm-weis-ad-left","alm-weis-ad-left-2","alm-save-ad-left","alm-save-ad-left-2","alm-lucky-ad-left","alm-lucky-ad-left-2","alm-bristol-ad-left","alm-bristol-ad-left-2","alm-rite-ad-left","alm-rite-ad-left-2","alm-bartell-ad-left","alm-bartell-ad-left-2","alm-cardenas-ad-left","alm-cardenas-ad-left-2","alm-petfoodexpress-ad-left","alm-petfoodexpress-ad-left-2","alm-allthebestpetcare-ad-left","alm-allthebestpetcare-ad-left-2","alm-coop-ad-left","alm-coop-ad-left-2","alm-pampanorama-ad-left","alm-pampanorama-ad-left-2","alm-iceland-ad-left","alm-iceland-ad-left-2","alm-arcs-ad-left","alm-arcs-ad-left-2","alm-seijoishii-ad-left","alm-seijoishii-ad-left-2","alm-life-ad-left","alm-life-ad-left-2","alm-tegut-ad-left","alm-tegut-ad-left-2","merchandised-search-top-1","merchandised-search-7","auto-left-advertising-1","auto-left-advertising-2","gwm-atf-dashboard"];class qe{resize(e){var t;if(!this.isAllowedSize(e))return l(`Size w:'${e.width}', h:'${e.height}' is not allow-listed for '${this.name}'`),!1;const i=this.wrapperDiv,a=this.div,n=this.safeframe;return null==i||i.removeAttribute("style"),i&&(i.style.overflow="hidden"),i&&(i.style.backgroundColor="white"),a.removeAttribute("style"),a.style.lineHeight="0",!i&&(a.style.marginBottom="20px"),a.style.marginLeft="auto",a.style.marginRight="auto",a.style.maxHeight="inherit",a.style.maxWidth=i?"min(100vh, 100vw)":"inherit",a.style.position="relative",n.style.height="100%",n.style.width="100%",n.removeAttribute("height"),n.removeAttribute("width"),n.style.removeProperty("min-width"),n.style.removeProperty("max-height"),n.style.removeProperty("padding-bottom"),null===(t=this.card)||void 0===t||t.style.setProperty("padding","0"),Ae(e.height)||Ae(e.width)?(a.style.width=Ne(e.width),a.style.height=i&&ve().isT1()?Fe(e.height):Ne(e.height)):(a.style.aspectRatio=`${parseInt(e.width)} / ${parseInt(e.height)}`,i&&ve().isT1()&&(a.style.minHeight=Fe(e.height))),this.resizeHandleSpecialCases(e),De(this.id,this.wrapperDiv),!0}collapse(){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none"}resizeHandleSpecialCases(e){const t=this.div;if(je(this.slotName,e))t.style.maxWidth=Ne(e.width);else if(Xe(this.slotName)){var i;const e=this.wrapperDiv;null==e||e.style.setProperty("width","100vw"),null==e||e.style.setProperty("margin-left","calc(-50vw + 50%)"),null==e||e.style.setProperty("margin-right","calc(-50vw + 50%)"),t.style.removeProperty("aspect-ratio"),t.style.removeProperty("max-width"),t.style.height=ve().isT1()?Fe("50px"):"50px",null===(i=t.closest(".a-container"))||void 0===i||i.style.setProperty("padding-top","0")}else if(Je(this.slotName)){t.style.removeProperty("aspect-ratio"),t.style.removeProperty("max-width"),t.style.height="55px",t.style.width="100vw",t.style.marginLeft="calc(-50vw + 50%)",t.style.marginRight="calc(-50vw + 50%)",ze()&&(t.style.width="100%",t.style.removeProperty("margin-left"),t.style.removeProperty("margin-right"));const e=document.createElement("style");e.innerHTML=`@media screen and (max-width: 1000px) {div[id$=${this.div.id}] { width: 100% !important; margin-left: 0 !important; margin-right: 0 !important; }}`,this.div.prepend(e);const i=document.createElement("style");i.innerHTML=`#${t.id}_Feedback { margin-right: 10px; }`,t.prepend(i)}else if(Ue.includes(this.slotName)){if(ye().isT1())return;this.div.style.maxWidth="300px",this.div.style.marginTop="47px",this.div.style.removeProperty("margin-left"),this.div.style.removeProperty("margin-right")}else if("hero-quick-promo"===this.slotName||"fresh-hero-quick-promo"===this.slotName||"wfm-hero-quick-promo"===this.slotName){if(ye().isT1())return;this.div.style.maxWidth="650px",this.div.style.removeProperty("margin-left"),this.div.style.removeProperty("margin-right")}}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}get safeframe(){return document.getElementById(this.safeframeId)}get card(){return document.getElementById(`ape_${this.name}_aui_card`)}constructor(e,t,i,a,n,s,r){this.id=e,this.name=t,this.wrapperDivId=i,this.divId=a,this.safeframeId=n,this.slotName=s,this.allowedSizes=r,this.isAllowedSize=e=>this.allowedSizes.some((t=>Ne(e.height)===t.height&&Ne(e.width)===t.width))}}const Je=e=>$e.includes(e),Xe=e=>We.includes(e),je=(e,t)=>970===parseInt(t.width)||980===parseInt(t.width)||728===parseInt(t.width)||Ve.includes(e),Ye=e=>Ke(e,[]),Ke=(e,t)=>{var i;return new qe(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId,e.adUnitIframeId,e.slotName,(null!==(i=e.allowedSizes)&&void 0!==i?i:[]).concat({height:Ne(e.size.height),width:Ne(e.size.width)}).concat(t.map((e=>({height:Ne(e.height),width:Ne(e.width)})))))},Ge=[{p:50,t:2,def:"iab"}],Ze=[{p:0,t:0,def:"amzn"},{p:50,t:1,def:"iab"},{p:100,t:1,def:"groupm"}],Qe=[{p:0,t:0,def:"amzn"},{p:30,t:1,def:"iab"},{p:100,t:1,def:"groupm"}],et=()=>window.innerHeight||document.documentElement.clientHeight,tt=()=>window.innerWidth||document.documentElement.clientWidth,it=e=>e.getBoundingClientRect().top-et(),at=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),nt=e=>{const t=e.getBoundingClientRect();return at(t,Number(window.getComputedStyle(e,null).zIndex))},st=e=>{const t=ct(e);return{t:e.t,l:e.l,r:e.r,b:e.b,w:e.w,h:e.h,z:e.z,xiv:t.xiv,yiv:t.yiv,iv:t.iv}},rt=()=>{const e=window.screenY?window.screenY:window.screenTop,t=window.screenX?window.screenX:window.screenLeft,i=tt(),a=et();return{t:e,l:t,w:i,h:a,b:e+a,r:t+i}},ot=e=>{const t=rt(),i=(e=>st(nt(e)))(e),a=mt(e);return{atf:lt(e),geom:{win:t,self:i,exp:a},payload:{wh:t.h,ww:t.w,sx:window.scrollX,sy:window.scrollY,ah:i.h,aw:i.w,top:i.t,left:i.l}}},lt=e=>{const t=function(e){const t=document.body.getBoundingClientRect();if(dt(t))return null;const i=nt(e),a=et(),n=tt(),s=Math.max(0,Math.min(t.left+n,i.r)-i.l),r=Math.max(0,Math.min(t.top+a,i.b)-i.t),o=s*r/(i.h*Math.min(i.w,n));return Number(Math.min(1,Math.max(0,o)).toFixed(2))}(e);return null==t?"unknown":t>=.5},dt=e=>0===e.width&&0===e.height;const ct=e=>{const t=tt(),i=et(),a=Math.max(0,ut(e.t,e.b,i)),n=Math.max(0,ut(e.l,e.r,t)),s=a*n,r=e.h*Math.min(e.w,t);return 0!==r||0!==s?{xiv:Number(Math.min(1,n/e.w).toFixed(2)),yiv:Number(Math.min(1,a/e.h).toFixed(2)),iv:Number(Math.min(1,Math.max(0,s/r)).toFixed(2))}:{xiv:0,yiv:0,iv:0}},mt=e=>{const t=e.getBoundingClientRect();return ht(t)},ht=e=>({t:e.top,l:e.left,r:tt()-e.right,b:et()-e.bottom,xs:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)>tt()?1:0,yx:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)>et()?1:0}),pt=e=>ht(e),ut=(e,t,i)=>{let a=0;return"visible"!==document.visibilityState?a:(a=e>0?i-e:t>0?Math.min(t,i):0,Math.min(a,t-e))},wt=(e,t)=>{const i=nt(e),a=nt(t),n=tt(),s=et();return i&&a&&(Math.abs(i.t-a.b)<s||Math.abs(i.b-a.t)<s)&&(Math.abs(i.l-a.r)<n||Math.abs(i.r-a.l)<n)},vt=e=>{const t=parseInt(e.size.height)*parseInt(e.size.width)>=242500;return"V"===e.mediaType?Ge:t?Qe:Ze};function gt(e,t,i){var a,n=i||{},s=n.noTrailing,r=void 0!==s&&s,o=n.noLeading,l=void 0!==o&&o,d=n.debounceMode,c=void 0===d?void 0:d,m=!1,h=0;function p(){a&&clearTimeout(a)}function u(){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];var o=this,d=Date.now()-h;function u(){h=Date.now(),t.apply(o,n)}function w(){a=void 0}m||(l||!c||a||u(),p(),void 0===c&&d>e?l?(h=Date.now(),r||(a=setTimeout(c?w:u,e))):u():!0!==r&&(a=setTimeout(c?w:u,void 0===c?e-d:e)))}return u.cancel=function(e){var t=(e||{}).upcomingOnly,i=void 0!==t&&t;p(),m=!i},u}const ft=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)};var yt={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},bt=function(e){var t,i,a=e.latencyEvent,n=e.scope,s=e.placement,r=e.timestamp;xt(a)&&(It(a,Pt(n),s.id,r),It(a,Pt(n),T(s.name),r),It(a,Pt(n),null!==(t=I(s.name))&&void 0!==t?t:void 0,r),It(a,Pt(n),null!==(i=S(s.id))&&void 0!==i?i:void 0,r))},xt=function(e){return"function"==typeof window[yt[e]]},It=function(e,t,i,a){void 0===a&&(a=new Date);var n=yt[e];i&&"function"==typeof window[n]&&window[n](e,t+i,{wb:1},a)},Pt=function(e){return"adplacements:"+St(e)},St=function(e){return e?"".concat(e,":"):""},Tt=function(e,t,i){if(window.csa)try{window.csa("Content",{element:e})("mark",t,null==i?void 0:i.getTime())}catch(a){l("Error with 'mark' CSA",a)}};class kt{sendLatencyMetric({latencyMetricType:e,placementId:t,placementName:i,placementDivId:a,timestamp:n}){bt({latencyEvent:e.csmKey,scope:e.csmMessage,placement:{id:t,name:i},timestamp:n}),Tt(document.getElementById(a),e.csaKey,n)}}const Et=()=>new kt,Mt="sfImpression",At="LightAdImpression",Ct="viewablelatency",Nt=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),Ft=Nt("bodyBegin","bb"),Lt=Nt("bodyBegin","bb",Mt),Dt=(Nt("bodyBegin","bb",At),Nt("bodyEnd","be"),Nt("clickToATF","af"),Nt("criticalFeature","cf"),Nt("criticalFeature","cf",Mt),Nt("criticalFeature","cf",At),Nt("loaded","ld"),Nt("loaded","ld",Mt),Nt("loaded","ld",At),Nt("viewablelatency:bodyBegin","bb",Ct)),_t=Nt("viewablelatency:loaded","ld",Ct),zt=(e,t,i)=>e>0?i>e:t>0,Ot=(e,t,i,a,n,s)=>{var r,o,l;const d=null===(l=document)||void 0===l||null===(o=l.getElementById)||void 0===o||null===(r=o.call(l,i))||void 0===r?void 0:r.getBoundingClientRect();if(d&&zt(d.top,d.bottom,et())&&zt(d.left,d.right,tt())){if(Et().sendLatencyMetric({latencyMetricType:Dt,placementId:n,placementName:a,placementDivId:i,timestamp:new Date}),e[s].loaded){Et().sendLatencyMetric({latencyMetricType:_t,placementId:n,placementName:a,placementDivId:i,timestamp:new Date});const e={id:n,name:a};k("adplacements:htmlviewed:loaded:",e),k("adplacements:htmlviewed",e)}t.viewed=!0,c=t.tracker,window.removeEventListener("scroll",c),window.removeEventListener("resize",c),document.removeEventListener("visibilitychange",c)}var c},Bt=(t,i)=>{if(!t[i.arid]){t[i.arid]={valid:!1};try{const a=t[i.arid];Ot(t,a,i.adUnitPlacementId,i.placementName,i.placementId,i.arid);const n=e(gt(20,(()=>{Ot(t,a,i.adUnitPlacementId,i.placementName,i.placementId,i.arid)})),l);ft(n),a.tracker=n,a.valid=!0}catch(a){throw l("Error initializing viewable latency instrumentation",a),a}}},Rt="aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ",Ht=(e,t,i)=>{Ut($t(e,i,Wt(t)))},Ut=e=>{new ue(window,"ADPT_SF_METRICS_LOGGING_1100263").isT1()&&navigator.sendBeacon(`https://e5qq6zj76g.execute-api.us-east-1.amazonaws.com/metric?x-api-key=${Rt}`,JSON.stringify(e))},$t=(e,t,i)=>({metricName:e,timestamp:(new Date).getTime(),count:t,dimensions:i,xApiKey:Rt}),Wt=e=>{var t,i;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:null===(t=e.adCreativeMetaData)||void 0===t?void 0:t.adProgramId,creativeTemplateName:null===(i=e.adCreativeMetaData)||void 0===i?void 0:i.adCreativeTemplateName,deviceType:e.deviceType}},Vt=(e,t)=>{try{k("coordinate:x",e,e.div.getBoundingClientRect().x),k("coordinate:y",e,e.div.getBoundingClientRect().y),Ht("coordinate:x",t,e.div.getBoundingClientRect().x),Ht("coordinate:y",t,e.div.getBoundingClientRect().y)}catch(i){return}},qt=e=>{E("resize:size:request"),"V"===e.mediaType?E("resize:size:request:V"):E("resize:size:request:D"),e.creative.size?Jt(e)&&("100%"===e.size.width||0===e.creative.size.width?Ht("resize:size:differresponsive",e):Ht("resize:size:differfixed",e),E("resize:size:differ")):(E("resize:size:missing"),"V"===e.mediaType?E("resize:size:missing:V"):E("resize:size:missing:D"),Ht("resize:size:missing",e)),Yt(e)||Ht("creativesize:slotsizediffer",e),(Ae(e.size.height)||Ae(e.size.width))&&Ht("creative:size:percentage",e)},Jt=e=>{const t=e.creative.size;return Xt(e,t)||jt(e,t)},Xt=(e,t)=>(null==t?void 0:t.height)!==parseInt(e.size.height),jt=(e,t)=>{const i=(null==t?void 0:t.width)!==parseInt(e.size.width),a="100%"===e.size.width&&0===(null==t?void 0:t.width);return i&&!a},Yt=e=>{const t=e.creative.size;return!t||0===t.width||0===t.height||e.slotSizes.some((e=>e.width===t.width&&e.height===t.height))},Kt=(e,t)=>{const i=e=>Ae(e)?e:parseInt(e),a=i(t.height),n=i(t.width);Ht(`creative:size:changeSize:${n}x${a}`,e)},Gt=(e,t,i)=>{Et().sendLatencyMetric({latencyMetricType:Lt,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),i&&(Et().sendLatencyMetric({latencyMetricType:Ft,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId,timestamp:i}),bt({latencyEvent:"wb",placement:t,timestamp:i})),k("adload:start",t),L("adload_start",t),k("adload:delayloadcallback",t),L("adload_delayload",t)};class Zt{constructor(e,t){this.hc=e,this.hmr=t,this.initializeAdMap=(e,t)=>{try{this.hc.adMap[e.arid]={messagePort:t}}catch(i){l(`Error creating safeFrame ${e.slotName}`,i)}},this.secondPhaseLoadAd=async(e,t,i,a)=>{await this.setupMessageChannel(i,t,a)},this.setupMessageChannel=async(e,t,i)=>{var a,n;null===(n=performance)||void 0===n||null===(a=n.mark)||void 0===a||a.call(n,`SafeFrame: Start setupMessagePort ${t.adUnitPlacementId}`),this.initializeAdMap(t,e);const s=this.hc;s.ADS_HANDLERS[t.arid]=s.ADS_HANDLERS[t.arid]||{};const r=Ye(t);r.resize(t.size),qt(t),Vt(r,t),Gt(t,r,i),Bt(s.viewableLatencyTrackers,t);try{await Te(t),Qt(s,t,this.hmr),ei(t)}catch(o){throw r.collapse(),o}}}}const Qt=(e,t,i)=>{e.adMap[t.arid].messagePort.onmessage=i.receiveMessage},ei=e=>{var t;Je((t=e).slotName)&&Be(document.getElementById(t.adUnitPlacementId))},ti=e=>{const t=ii(e),i=rt(),a=st(at(t,NaN));return{atf:"unknown",geom:{win:i,self:a,exp:pt(t)},payload:{wh:i.h,ww:i.w,sx:window.scrollX,sy:window.scrollY,ah:a.h,aw:a.w,top:a.t,left:a.l}}},ii=e=>{const t=e.initialBoundingRect,i=t.top-(window.scrollY-e.originalScrollY),a=i+e.adHeight,n=t.left-(window.scrollX-e.originalScrollX);return{top:i,bottom:a,left:n,right:n+e.adWidth,width:e.adWidth,height:e.adHeight}},ai="btr_client",ni="cod_client",si=async(e,t)=>{if(e&&e.trim().match(/^\d{1,4}px$/g))return await ri(parseInt(e,10),t,((e,t)=>{const i=it(e);return e&&i<=t}))},ri=async(t,i,a)=>new Promise((n=>{const s=()=>{a(i,t)&&(n(),window.removeEventListener("scroll",r),window.removeEventListener("resize",r))},r=e(gt(20,(()=>{s()})),l);window.addEventListener("scroll",r),window.addEventListener("resize",r),s()})),oi=(e,t,i,a,n,s)=>{const r=null==e?void 0:e[t];(null==r?void 0:r.valid)&&(r.loaded=!0,r.viewed&&(Et().sendLatencyMetric({latencyMetricType:_t,placementId:a,placementName:i,placementDivId:n,timestamp:new Date(s)}),k("htmlviewed:loaded",{id:a,name:i})))},li=async(e,t)=>{let i,a;return new Promise((n=>{a=n,i=new IntersectionObserver((t=>{t.forEach((t=>{t.target===e&&t.isIntersecting&&(a(t),i.unobserve(e))}))}),t),i.observe(e)}))},di=e=>{const t=document.getElementById(e.adUnitIframeId);return t||E("getiframe:undefined"),t},ci=async e=>{const t=di(e),i={root:mi(t)?null:document.documentElement};await li(t,i)},mi=e=>{let t=e;for(;t;){if("fixed"===window.getComputedStyle(t,null).getPropertyValue("position"))return!0;t=t.parentElement}return!1},hi=e=>{const t=document.getElementById(e.adUnitPlacementId);return t||E("getplacement:undefined"),t},pi=async(e,t)=>{Ht("debug:pixel:cod:prehost",t),t.firePixelsAfter&&await si(t.firePixelsAfter,hi(t)),await ci(t),Ht("debug:pixel:cod:host",t),e.sendMessageToAd(t.arid,"fireImpression",{measurementMethod:ni,isNoInventory:!1})},ui=(e,t,i)=>{wi(e,i);const a=t.ADS_HANDLERS[i.arid];a.viewabilityTracker=()=>{gt(50,wi)(e,i)},ft(a.viewabilityTracker);new IntersectionObserver((()=>{wi(e,i)}),{threshold:[0,.5,1]}).observe(hi(i))},wi=(e,t)=>{const i=di(t),a=vt(t);if(i){const n=ot(i);n.viewabilityStandards=a,e.sendMessageToAd(t.arid,"updateViewability",n)}},vi=(e,t,i)=>{const a=vt(t),n=ti(i);n.viewabilityStandards=a,e.sendMessageToAd(t.arid,"updateViewability",n)},gi=e=>{const t=di(e);return{initialBoundingRect:(i=t).getBoundingClientRect(),adHeight:i.offsetHeight,adWidth:i.offsetWidth,originalScrollX:window.scrollX,originalScrollY:window.scrollY};var i},fi=(e,t,i)=>{if(""===t)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));const a=new URL(e),n=a.searchParams.get(t),s=n||"{}",r=JSON.parse(s),o=Object.assign(r,i);return a.searchParams.set(t,JSON.stringify(o)),a.toString()},yi=({abpAcceptable:e="false",abpStatus:t="-1"})=>"true"===e&&("1"===t||"-1"===t);class bi{async fire(e){this.isFired||(await fetch(this.pixelUrl(this.url,e),{keepalive:!0,mode:"no-cors"}),e.div.appendChild(this.pixel(e)),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}shouldFirePixel(e){return!0}logOnFirePixel(e,t){E(`pixel:${this.logId}`),k(`pixel:${this.logId}`,t),E(`pixel:${this.logId}:${e.aaxProgramId}`)}constructor(e,t,i,a){this.url=e,this.loggingContext=a,this.isFired=!1,this.pixel=e=>{const t=document.createElement("img");return t.id=`${this.pixelId}_${e.name}`,t.style.display="none",t.setAttribute("pixel-url",this.pixelUrl(this.url,e)),t},this.shouldAppendABPTag=yi({abpAcceptable:t,abpStatus:i})}}class xi extends bi{constructor(e,t,i,a){super(e,t,i,a),this.pixelId="ape_impression",this.logId="imp:cod",this.pixelUrl=(e,t)=>fi(e,"pj",this.pixelUrlParameters(t)),this.pixelUrlParameters=e=>({measurementMethod:ni,ape_al:!!this.shouldAppendABPTag||void 0})}}class Ii extends bi{constructor(e,t,i,a){super(e,t,i,a),this.pixelId="ape_measurability",this.logId="imp:atf",this.pixelUrl=(e,t)=>`${e.replace(/\/$/,"")}/atf/${JSON.stringify(this.pixelUrlParameters(t))}`,this.pixelUrlParameters=e=>({atf:lt(e.div),ape_al:!!this.shouldAppendABPTag||void 0})}}const Pi=async e=>new Promise(((t,i)=>{if(!P)return void i(new Error("mash:getbottombars:missing"));const a=setTimeout((()=>{i(new Error("mash:getbottombars:timeout"))}),e),n=performance.now();P.when("ConfigChromeFramework").execute((e=>{e.getBottomBarsHeight({successCallback:e=>{clearTimeout(a),t({heightPx:e.visibleHeight,latencyMs:performance.now()-n})},failCallback:()=>{i(new Error("mash:getbottombars:failure"))}})}))})),Si=async e=>new Promise(((t,i)=>{if(!P)return void i(new Error("mash:getchromeinfo:missing"));const a=setTimeout((()=>{i(new Error("mash:getchromeinfo:timeout"))}),e),n=performance.now();P.when("MShopChrome").execute((e=>{e.getChromeInfo({successCallback:e=>{clearTimeout(a),t({heightPx:e.portraitChromeHeight,isOverlapping:e.isTransparentNav,latencyMs:performance.now()-n})},failCallback:()=>{i(new Error("mash:getchromeinfo:failure"))}})}))})),Ti=(e,t)=>{const i=e.getBoundingClientRect(),a=ki(i),n=[];for(const[o,l]of a){if(!Ei(o,l))continue;const t=Ni(o,l);for(const a of t){if(!(a instanceof HTMLElement))continue;if(a===e||e.contains(a))break;const t=window.getComputedStyle(a);if("none"===t.display||"hidden"===t.visibility||"0"===t.opacity||"none"===t.pointerEvents||parseFloat(t.opacity)<.7)continue;const s=t.backgroundColor;if(!("transparent"===s||"rgba(0,0,0,0)"===s||""===s)||t.backgroundImage.includes("url")){n.push({x:o-i.left,y:l-i.top});break}}}const s=a.length,r=n.length/s;return Mi(e)-r<t},ki=e=>{const t=[];if(ge().isT1())for(let i=0;i<10;i++)for(let a=0;a<10;a++)t.push([e.left+e.width*(a+.5)/10,e.top+e.height*(i+.5)/10]);else if(ge().isT2()||ge().isT3()||ge().isT4()||ge().isT5())for(let i=0;i<10;i++)t.push([e.left+e.width/2,e.top+e.height*(i+.5)/10]);return t},Ei=(e,t)=>{const i=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return e>=0&&e<=i&&t>=0&&t<=a},Mi=e=>{const t=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,a=window.innerWidth||document.documentElement.clientWidth,n=Math.max(0,t.top),s=Math.max(0,t.left),r=Math.min(i,t.bottom),o=Math.min(a,t.right);if(t.top>=i||t.left>=a||t.bottom<=0||t.right<=0||t.width<=0||t.height<=0)return 0;return(o-s)*(r-n)/(t.width*t.height)},Ai=(e,t)=>{const i=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));if(0===i||0===a)return 0;return i*a/(e.width*e.height)},Ci=(e,t)=>({top:t,bottom:t+e,left:0,right:window.innerWidth,width:window.innerWidth,height:e}),Ni=(e,t)=>{let i=[];if(ge().isT1()||ge().isT2())i=document.elementsFromPoint(e,t);else if(ge().isT3()||ge().isT4()||ge().isT5()){const a=document.elementFromPoint(e,t);a&&i.push(a)}return i};class Fi extends bi{isBottomOccluded(e){if(0===this.nativeBottomOcclusion)return!1;return Mi(e)-Ai(e.getBoundingClientRect(),Ci(this.nativeBottomOcclusion,window.innerHeight-this.nativeBottomOcclusion))<this.thresholdPercentage}isTopOccluded(e){if(0===this.nativeTopOcclusion)return!1;return Mi(e)-Ai(e.getBoundingClientRect(),Ci(this.nativeTopOcclusion,0))<this.thresholdPercentage}checkOcclusionsAndFire(e,t){try{if(this.shouldBlockPixelFireForNative=!1,this.shouldBlockPixelFireForDOM=!1,_i()&&(this.logMetrics("viewPixel:iab:fired",1,t),Ti(t.div,this.thresholdPercentage)&&(this.logMetrics("viewPixel:iab:obstruction:UXElement",1,t),this.shouldBlockPixelFireForDOM=!0)),Di(t)&&fe().isT1()){this.logMetrics("viewPixel:iab:mshop:fired",1,t);(this.isBottomOccluded(t.div)||this.isTopOccluded(t.div))&&(this.logMetrics("viewPixel:iab:obstruction:native",1,t),this.shouldBlockPixelFireForNative=!0)}this.shouldBlockPixelFireForNative||ge().isT5()&&this.shouldBlockPixelFireForDOM?(this.wasOccluded=!0,this.timeoutId=setTimeout((()=>this.checkOcclusionsAndFire(e,t)),this.thresholdTimeVisibleMs)):ge().isT4()&&this.shouldBlockPixelFireForDOM?(this.wasOccluded=!0,this.fireInObserver(e,t),this.timeoutId=setTimeout((()=>this.checkOcclusionsAndFire(e,t)),this.thresholdTimeVisibleMs)):this.fireInObserver(e,t)}catch(i){d(i),this.fireInObserver(e,t)}}fireInObserver(e,t){this.fire(t),ge().isT4()||e.unobserve(t.div),Di(t)&&this.wasOccluded&&!this.shouldBlockPixelFireForNative?this.logMetrics("viewPixel:iab:obstruction:recovered",1,t):this.wasOccluded&&!this.shouldBlockPixelFireForDOM&&(this.logMetrics("viewPixel:iab:obstruction:recovered:dom",1,t),ge().isT4()&&e.unobserve(t.div)),we().isT1()&&this.removeVisibilityChangeDetection()}async fetchNativeObstructions(){try{const e=await Pi(950);this.logMetrics("mash:getbottombars:latency",e.latencyMs),this.nativeBottomOcclusion=e.heightPx;const t=await Si(950);this.logMetrics("mash:gettopnav:latency",t.latencyMs),this.nativeTopOcclusion=t.isOverlapping?t.heightPx:0}catch(e){this.logMetrics(e.message)}}track(e){Di(e)&&fe().isT1()&&this.fetchNativeObstructions(),new IntersectionObserver(((t,i)=>{t.forEach((t=>{t.isIntersecting?this.thresholdTimeVisibleMs>0?(this.timeoutId=setTimeout((()=>this.checkOcclusionsAndFire(i,e)),this.thresholdTimeVisibleMs),we().isT1()&&this.setupVisibiltyChangeDetection(this.timeoutId,i,e)):this.fireInObserver(i,e):(clearTimeout(this.timeoutId),we().isT1()&&this.removeVisibilityChangeDetection())}))}),{threshold:this.thresholdPercentage}).observe(e.div)}removeVisibilityChangeDetection(){this.visibilityChangeHandler&&(document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.visibilityChangeHandler=null)}setupVisibiltyChangeDetection(e,t,i){this.removeVisibilityChangeDetection(),this.visibilityChangeHandler=()=>Li(e,t,i),document.addEventListener("visibilitychange",this.visibilityChangeHandler)}async fire(e){return this.shouldFirePixel(e)||await this.waitUntilShouldFirePixel(e),super.fire(e)}waitUntilShouldFirePixel(e){return new Promise((t=>{this.timeoutId=setInterval((()=>{this.shouldFirePixel(e)&&(clearInterval(this.timeoutId),t())}),10)}))}logMetrics(e,t=1,i){this.logId.includes("iab")&&!this.metricsLogged.has(e)&&(E(e,t),D(e,t),i&&(k(e,i,t),L(e,i,t)),this.metricsLogged.add(e))}constructor(e,t,i,a,n,s){super(e,t,i,a),this.thresholdPercentage=n,this.thresholdTimeVisibleMs=s,this.visibilityChangeHandler=null,this.nativeBottomOcclusion=0,this.nativeTopOcclusion=0,this.wasOccluded=!1,this.metricsLogged=new Set,this.shouldBlockPixelFireForDOM=!1,this.shouldBlockPixelFireForNative=!1}}const Li=(e,t,i)=>{document.hidden?(clearTimeout(e),t.unobserve(i.div)):t.observe(i.div)},Di=e=>{var t;return"mshop"===(null==e||null===(t=e.deviceType)||void 0===t?void 0:t.toLowerCase())},_i=()=>ge().isT1()||ge().isT2()||ge().isT3()||ge().isT4()||ge().isT5();class zi extends Fi{get pixelId(){return`ape_viewability_${this.definition}`}set isBtr(e){this._isBtr=e}constructor(e,t,i,a,n,s,r,o,l){super(e,t,i,a,n,s),this.definition=r,this.aPageStart=o,this.adStartTime=l,this._isBtr=!1,this.pixelUrl=(e,t)=>`${e.replace(/\/+$/,"")}/v/${JSON.stringify(this.pixelUrlParameters(t))}`,this.pixelUrlParameters=e=>({ape_al:!!this.shouldAppendABPTag||void 0,v:{def:this.definition,p:this.thresholdPercentage,t:this.thresholdTimeVisibleMs,ib:this._isBtr},wh:window.innerHeight||document.documentElement.clientHeight,ww:window.innerWidth||document.documentElement.clientWidth,sx:window.scrollX,sy:window.scrollY,ah:e.div.getBoundingClientRect().height,aw:e.div.getBoundingClientRect().width,top:e.div.getBoundingClientRect().top,left:e.div.getBoundingClientRect().left,ptv:(performance.now()-this.aPageStart)/1e3,ttv:(performance.now()-this.adStartTime)/1e3}),this.logId=`view:${this.definition}`}}class Oi extends zi{constructor(e,t,i,a,n,s){super(e,t,i,a,0,0,"amzn",n,s)}}class Bi extends zi{constructor(e,t,i,a,n,s){super(e,t,i,a,1,1e3,"groupm",n,s)}}class Ri extends zi{constructor(e,t,i,a,n,s){super(e,t,i,a,.5,1e3,"iab",n,s)}}class Hi extends zi{constructor(e,t,i,a,n,s){super(e,t,i,a,.3,1e3,"iab",n,s)}}class Ui extends zi{track(e){super.track(e);const t=e.creative.adElement;let i=0;t.addEventListener("play",(()=>{this.continuousPlaytime=0,i=performance.now()})),t.addEventListener("pause",(()=>this.continuousPlaytime=0)),t.addEventListener("ended",(()=>this.continuousPlaytime=0)),t.addEventListener("timeupdate",(()=>!t.paused&&(this.continuousPlaytime=performance.now()-i)))}shouldFirePixel(e){return super.shouldFirePixel(e)&&this.continuousPlaytime>=2e3}constructor(e,t,i,a,n,s){super(e,t,i,a,.5,2e3,"iab",n,s),this.continuousPlaytime=0}}const $i="AppAdsMshopIOSPlugin";class Wi extends xi{async fire(e){var t,i;this.isFired||(t=this.skAdNetwork,null===(i=window.P)||void 0===i||i.when($i).execute((e=>{e.startAttributeViewThroughAppAds({skAdNetwork:t})})),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}constructor(e,t,i,a,n){super(e,t,i,a),this.skAdNetwork=n,this.logId="imp:skan"}}class Vi extends Fi{pixelUrl(){throw new Error("PixelUrl should not be use for SkanViewPixel")}async fire(e){var t,i;this.isFired||(t=this.skAdNetwork,null===(i=window.P)||void 0===i||i.when($i).execute((e=>{e.endAttributeViewThroughAppAds({skAdNetwork:t})})),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}constructor(e,t,i,a,n){super(e,t,i,a,.5,2e3),this.skAdNetwork=n,this.pixelId="skan_view_pixel",this.logId="view:skan"}}class qi extends xi{constructor(e,t,i,a){super(e,t,i,a),this.pixelId="ape_btr_impression",this.logId="imp:btr",this.pixelUrl=(e,t)=>fi(o(e),"c",{measurementMethod:ai})}}const Ji=e=>new Ii(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext),Xi=e=>new Oi(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.aPageStart,e.adStartTime),ji=(e,t,i,a)=>"V"===e?Zi(i):Yi(a)&&Ki(t)?Qi(i):ea(i),Yi=e=>"DESKTOP"===e,Ki=e=>Gi(e)>=242500,Gi=e=>e.getBoundingClientRect().height*e.getBoundingClientRect().width,Zi=e=>new Ui(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.aPageStart,e.adStartTime),Qi=e=>new Hi(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.aPageStart,e.adStartTime),ea=e=>new Ri(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.aPageStart,e.adStartTime),ta=e=>new Bi(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.aPageStart,e.adStartTime),ia=e=>{if(e.skAdNetwork)return new Wi(e.aaxImpPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.skAdNetwork)},aa=e=>{if(e.skAdNetwork)return new Vi(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.skAdNetwork)},na=async e=>{var t,i;const a=Za(e),n={id:e.placementId,name:e.placementName,div:hi(e)};await(null===(t=ia(a))||void 0===t?void 0:t.fire(n)),null===(i=aa(a))||void 0===i||i.track(n)},sa=async(e,t,i,a)=>{i.firePixelsAfter&&await si(i.firePixelsAfter,hi(i)),await ci(i),a.measurementMethod===ai&&e.sendMessageToAd(i.arid,"fireImpression",{measurementMethod:ai,isNoInventory:a.isNoInventory}),na(i),ra(e,t,i,a.isNoInventory)},ra=(e,t,i,a)=>{a?((e,t,i)=>{const a=gi(i);vi(e,i,a),e.sendMessageToAd(i.arid,"collapseSlot",{});const n=t.ADS_HANDLERS[i.arid];n.noInventoryViewabilityTracker=()=>{gt(20,vi)(e,i,a)},ft(n.noInventoryViewabilityTracker)})(e,t,i):ui(e,t,i)},oa=({height:e,width:t,targetWidth:i})=>0===t||isNaN(e)||isNaN(t)||isNaN(i)?0:Math.round(i*e/t),la="expanded-feedback-label",da="expanded-safeframe",ca="expandable-ads-styles",ma=(e,t,i)=>{const a=fa(t,Ye(e).div.offsetWidth),n={height:Me(a),width:Me(e.size.width)},s=Ke(e,[n]);s.resize(n),ga(e),ua(e),s.div.style.height=n.height,ya(e,i,pa)},ha=(e,t,i)=>{const a=Ye(e).div.offsetHeight;ma(e,t,i);const n=Ye(e);n.div.style.zIndex="2",n.div.style.position="relative",n.div.parentElement&&n.div.parentElement.style.removeProperty("overflow"),n.div.parentElement&&(n.div.parentElement.style.height=a+"px")},pa=e=>{Ye(e).resize(e.size),va(e)},ua=e=>{const t=di(e),i=wa(t);if(null===i||null===t)throw new Error(`feedbackWrapper: ${i?"present":"missing"}, safeFrame: ${t?"present":"missing"}`);i.classList.add(la),t.classList.add(da)},wa=e=>{var t;let i=null==e?void 0:e.parentElement;return(null==i||null===(t=i.parentElement)||void 0===t?void 0:t.id.endsWith("_wrapper"))&&(i=i.parentElement),i.querySelector("div[id$=_Feedback]")},va=e=>{const t=di(e),i=wa(t);null!==i&&null!==t&&(i.classList.remove(la),t.classList.remove(da))},ga=e=>{(e=>{if(null!==document.querySelector(`#${ca}`))return;const t=document.createElement("style");t.id=ca,t.innerHTML=`\n        div.${la} {\n            background-color: white;\n            z-index: 2;\n            margin-top: 0px !important;\n            padding-top: 2px !important;\n        }`,document.getElementById(e.adUnitPlacementId).appendChild(t)})(e)},fa=(e,t)=>(e.staticHeight?parseInt(e.staticHeight,10):0)+(Ae(e.width)?parseInt(e.height,10):oa({height:parseInt(e.height,10),width:parseInt(e.width,10),targetWidth:t})),ya=(e,t,i)=>{const a=a=>{ba(a,e,t),i(e)};window.addEventListener("scroll",a,{once:!0}),window.addEventListener("click",a,{once:!0}),window.addEventListener("swipe",a,{once:!0}),window.addEventListener("tap",a,{once:!0})},ba=(e,t,i)=>{i.sendMessageToAd(t.arid,"triggerEventInIframe",{eventType:e.type})},xa="gw-video-orchestrator",Ia=(e,t,i)=>{var a;null===(a=window.P)||void 0===a||a.when(xa).execute((a=>{try{a.subscribe(e,t,i)}catch(s){n=`gw-video-orchestrator error: ${JSON.stringify(s)}`,console.debug(n)}var n}))},Pa=e=>{var t;null===(t=window.P)||void 0===t||t.when(xa).execute((t=>{t.elect(e)}))};let Sa=null;const Ta=(e,t,i)=>{const a=t=>i.sendCustomMessageToAd(e.arid,"videoAutoplayResponse",t);Ma(e.pageType)?Ia(di(e),a,t):Sa===e.arid?a(!0):null===Sa&&Aa(di(e))?(Sa=e.arid,a(!0)):a(!1)},ka=()=>{Pa(),Sa=null},Ea=e=>{var t;t=di(e),Pa(t),Sa=e.arid},Ma=e=>"gateway"===(null==e?void 0:e.toLowerCase()),Aa=e=>![...document.getElementsByTagName("video")].some((t=>!t.paused&&wt(e,t))),Ca=async e=>{var t,i;e.firePixelsAfter&&await si(e.firePixelsAfter,hi(e)),await ci(e),null===(t=(i=Za(e)).btrPixelUrl?new qi(i.btrPixelUrl,i.abpAcceptable,i.abpStatus,i.loggingContext):void 0)||void 0===t||t.fire({id:e.placementId,name:e.placementName,div:hi(e)})},Na=(e,t)=>{l(t.message+": "+e.placementName,t.error),l(t.message,t.error)},Fa=(e,t)=>{d(t.message+": "+e.placementName,t.error)},La=(e,t)=>{if(e.size.width===t.width&&e.size.height===t.height)return;Ye(e).resize(t)&&Kt(e,t)},Da=(e,t)=>L(t.metricName,{name:e.placementName,id:e.placementId}),_a=async(e,t,i)=>{const a=hi(e);await si(e.firePixelsAfter,a),await ci(e);const n=Za(e),s={id:e.placementId,name:e.placementName,div:a,deviceType:e.deviceType};Ji(n).fire(s),"V"!==e.mediaType?(Xi(n).track(s),ji(e.mediaType,s.div,n,e.deviceType).track(s),ta(n).track(s)):ui(t,i,e)};var za=function(e,t){Oa()&&Ba(e+Ra(t))},Oa=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.tag)},Ba=function(e){var t;return null===(t=null===window||void 0===window?void 0:window.ue)||void 0===t?void 0:t.tag(e)},Ra=function(e){return e?":".concat(e):""};const Ha=e=>{if(!(null==e?void 0:e.adCreativeMetaData)||!Object.keys(e.adCreativeMetaData).length)return za("noadrender"),void F({adrender:"false"});za("adrender"),za("adrender:safeframe"),Ua(e),Wa(e),Va(e),qa(e)},Ua=e=>{const t=$a(e);za("adrender","creativetemplatename:"+t),F({adrender:"true",creativeTemplateName:t,isLightAds:"false"})},$a=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Wa=e=>{e.adCreativeMetaData.adCreativeId&&(za("adrender","creativeid:"+e.adCreativeMetaData.adCreativeId),F({creativeId:e.adCreativeMetaData.adCreativeId}))},Va=e=>{e.adCreativeMetaData.adProgramId&&(za("adrender","programid:"+e.adCreativeMetaData.adProgramId),F({adProgramId:e.adCreativeMetaData.adProgramId}))},qa=e=>{void 0!==e.isCardsFlow&&F({isCardsFlow:e.isCardsFlow.toString()})},Ja="nav-cart",Xa=e=>{const t=document.documentElement,i=hi(e);ja(t,i),new MutationObserver((e=>{for(const t of e)if("attributes"===t.type&&"class"===t.attributeName){const e=t.target;ja(e,i)}})).observe(t,{attributes:!0,attributeFilter:["class"]})},ja=(e,t)=>{e.classList.contains("nav-ewc-persistent-hover")?t.classList.add(Ja):t.classList.remove(Ja)},Ya=new Set;class Ka{constructor(e,t){this.hms=e,this.hc=t,this.changeSize=La,this.startBTRPixelTracking=async(e,t)=>{await sa(this.hms,this.hc,e,t)},this.fireImpressionWithDelay=async e=>{await pi(this.hms,e)},this.logAPIInvocation=(e,t)=>{const i=`messenger:${t.apiName}`;E(i),k(i,{id:e.placementId,name:e.placementName})},this.logError=Na,this.logFatal=Fa,this.logCsaEvent=Da,this.sendLatencyMetric=(e,t)=>Ga(e,t),this.fireViewableLatencyMetrics=async(e,t)=>{oi(this.hc.viewableLatencyTrackers,e.arid,e.placementName,e.placementId,e.adUnitPlacementId,t.adLoadedTimestamp)},this.countMetric=(e,t)=>{t.isGlobal?E(t.metricMsg,t.value):k(t.metricMsg,{id:e.placementId,name:e.placementName},t.value)},this.requestVideoAutoplay=(e,t)=>{E("common:supported:command:requestVideoAutoplay"),Ta(e,t,this.hms)},this.releaseVideoAutoplay=()=>{E("common:supported:command:releaseVideoAutoplay"),ka()},this.haveVideoAutoplayPermission=e=>{E("common:supported:command:haveVideoAutoplayPermission"),Ea(e)},this.feedbackLabelRendered=e=>{Pe(e)},this.feedbackOpenModal=e=>{Se(e)},this.expandAdSlot=(e,t)=>{E("common:supported:command:expandAdSlot"),ma(e,t,this.hms)},this.expandAdSlotWithOverlap=(e,t)=>{E("common:supported:command:expandAdSlotWithOverlap"),ha(e,t,this.hms)},this.resetSlotSize=e=>{E("common:supported:command:resetSlotSize"),pa(e)},this.collapseSlot=e=>{Ye(e).collapse()},this.triggerEventInIframe=(e,t)=>{E("common:supported:command:triggerEventInIframe"),this.hms.sendMessageToAd(e.arid,"triggerEventInIframe",{eventType:t.event.type})},this.safeFrameReady=e=>{var t,i;null===(i=performance)||void 0===i||null===(t=i.mark)||void 0===t||t.call(i,`SafeFrame:  safeFrameReady ${e.slotName}`),this.hms.sendMessageToAd(e.arid,"setupComputedAdDetails",{computed:{aPageStart:window.aPageStart,adStartTime:(new Date).getTime()}}),window.addEventListener("resize",(()=>{this.hms.sendCustomMessageToAd(e.arid,"resize",{height:window.innerHeight,width:window.innerWidth})})),Ha(e),Xa(e)},this.sendEventAddedCreative=async e=>{var t;Ht("debug:pixel:cod:prededupe",e),Ya.has(e.placementId)||(Ht("debug:pixel:cod:prehost",e),e.firePixelsAfter&&await si(e.firePixelsAfter,hi(e)),await ci(e),Ht("debug:pixel:cod:host",e),(t=Za(e),new xi(t.aaxImpPixelUrl,t.abpAcceptable,t.abpStatus,t.loggingContext)).fire({id:e.placementId,name:e.placementName,div:hi(e)}),Ya.add(e.placementId))},this.sendEventCreativeBeginToRender=Ca,this.sendEventCreativeLoaded=async e=>{await _a(e,this.hms,this.hc)}}}const Ga=(e,{latencyMetricType:t,timestamp:i})=>{Et().sendLatencyMetric({latencyMetricType:t,placementName:e.placementName,placementId:e.placementId,placementDivId:e.adUnitPlacementId,timestamp:i})},Za=e=>{var t,i,a,n,s;return{aaxImpPixelUrl:e.aaxImpPixelUrl,aaxInstrPixelUrl:e.aaxInstrPixelUrl,aPageStart:null!==(a=null===(t=e.computed)||void 0===t?void 0:t.aPageStart)&&void 0!==a?a:0,adStartTime:null!==(n=null===(i=e.computed)||void 0===i?void 0:i.adStartTime)&&void 0!==n?n:0,abpAcceptable:e.abpAcceptable,abpStatus:null!==(s=e.abpStatus)&&void 0!==s?s:"-1",btrPixelUrl:e.btrPixelUrl,skAdNetwork:e.skAdNetwork,loggingContext:{aaxProgramId:Number(e.adCreativeMetaData.adProgramId)}}};const Qa=()=>{const e=new h,t=new p(e.adMap),i=new u(new Ka(t,e));return new Zt(e,i)},en=()=>{performance.mark("Safeframe: initSafeframeHostDesktop"),window.APE_SF||(performance.mark("Safeframe: initSafeframeHostDesktop init"),window.APE_SF=Qa())};e((()=>en()),l,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.5c0a6e47.js.map
